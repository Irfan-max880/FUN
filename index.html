<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Haunted Runner</title>
<style>
  body { margin:0; background:black; overflow:hidden; }
  canvas { display:block; margin:auto; background:black; }
</style>
</head>
<body>
<canvas id="game" width="1100" height="520"></canvas>

<audio id="bgMusic" loop preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2021/10/26/audio_9b2db5a5de.mp3?filename=haunted-house-ambience-1-minute-110057.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Images
const playerImg = new Image(); playerImg.src = "https://i.postimg.cc/jdn1KZYb/Screenshot-20250812-001657-removebg-preview.png";
const ghostImg  = new Image(); ghostImg.src  = "https://i.postimg.cc/vDwc43PK/Screenshot-2025-0812-174643-removebg-preview.png";
const bgImg     = new Image(); bgImg.src     = "https://i.postimg.cc/L5tmbRTy/Screenshot-2025-0812-173844.png";
const pumpkinImg= new Image(); pumpkinImg.src= "https://i.postimg.cc/FK6CkBSG/Screenshot-2025-0812-180233-removebg-preview.png";
const fogCanvas = document.createElement("canvas");
fogCanvas.width = canvas.width;
fogCanvas.height = canvas.height;
const fogCtx = fogCanvas.getContext("2d");

// Fog texture
const fogImg = new Image();
fogImg.src = "https://www.transparenttextures.com/patterns/foggy-birds.png";
let fogX = 0;

// Player
let player = { x:100, y:400, w:80, h:100, vy:0, jumping:false };
const gravity = 0.8;

// Ghost
let ghost = { x:-200, y:400, w:120, h:140, speed:0, chasing:false, chaseTimer:0, startDelay:120 };

// Pumpkins
let pumpkins = [];
let pumpkinTimer = 0;

// Score
let score = 0;
let gameOver = false;

// Music
const bgMusic = document.getElementById("bgMusic");
let musicStarted = false;
function startMusic() {
  if (!musicStarted) {
    musicStarted = true;
    bgMusic.play().catch(e=>console.log("Music blocked:",e));
  }
}

// Input
document.addEventListener("keydown", e => {
  startMusic();
  if ((e.code === "Space" || e.code === "ArrowUp") && !player.jumping && !gameOver) {
    player.vy = -15;
    player.jumping = true;
  }
  if (e.code === "Enter" && gameOver) restartGame();
});
canvas.addEventListener("click", () => {
  startMusic();
  if (!player.jumping && !gameOver) {
    player.vy = -15;
    player.jumping = true;
  }
  if (gameOver) restartGame();
});

// Main loop
function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Background
  if (bgImg.complete) ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
  ctx.fillStyle = "rgba(0,0,0,0.4)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Spawn pumpkins
  pumpkinTimer++;
  if (pumpkinTimer > 150) {
    pumpkins.push({ x:canvas.width, y:440, w:50, h:50, glow:0 });
    pumpkinTimer = 0;
  }

  // Draw pumpkins
  pumpkins.forEach(p => {
    p.x -= 5;
    p.glow += 0.1;
    ctx.save();
    ctx.shadowColor = "orange";
    ctx.shadowBlur = 15 + 5*Math.sin(p.glow);
    ctx.drawImage(pumpkinImg,p.x,p.y,p.w,p.h);
    ctx.restore();

    if (checkPumpkinCollision(player,p)) {
      ghost.chasing = true;
      ghost.speed = 3;
      ghost.chaseTimer = 180;
    }
  });
  pumpkins = pumpkins.filter(p => p.x + p.w > 0);

  // Player physics
  player.y += player.vy;
  player.vy += gravity;
  if (player.y >= 400) { player.y = 400; player.jumping = false; }

  // Ghost movement
  if (ghost.startDelay > 0) {
    ghost.startDelay--;
  } else {
    if (!ghost.chasing) ghost.speed = 0.3;
    ghost.x += ghost.speed;
  }

  if (ghost.chasing) {
    ghost.chaseTimer--;
    if (ghost.chaseTimer <= 0) {
      ghost.chasing = false;
      ghost.speed = 0.3;
    }
  }

  // Ghost collision using smaller hitbox
  let ghostHitbox = {
    x: ghost.x + 20,
    y: ghost.y + 10,
    w: ghost.w - 40,
    h: ghost.h - 20
  };
  if (rectsOverlap(player, ghostHitbox)) gameOver = true;

  // Draw ghost
  ctx.drawImage(ghostImg, ghost.x, ghost.y, ghost.w, ghost.h);

  // Draw player
  ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);

  // Fog
  if (fogImg.complete) {
    fogX -= 0.3;
    fogCtx.clearRect(0,0,fogCanvas.width,fogCanvas.height);
    const pattern = fogCtx.createPattern(fogImg,"repeat");
    fogCtx.fillStyle = pattern;
    fogCtx.translate(fogX,0);
    fogCtx.fillRect(-fogCanvas.width,0,fogCanvas.width*3,fogCanvas.height);
    fogCtx.setTransform(1,0,0,1,0,0);
    ctx.globalAlpha = 0.15;
    ctx.drawImage(fogCanvas,0,0);
    ctx.globalAlpha = 1;
  }

  // Score
  ctx.fillStyle = "white";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 20, 30);

  if (!gameOver) requestAnimationFrame(loop);
  else {
    ctx.fillStyle="white";
    ctx.font="40px Arial";
    ctx.fillText("GAME OVER", canvas.width/2 - 120, canvas.height/2);
    ctx.font="20px Arial";
    ctx.fillText("Press Enter or Click to Restart", canvas.width/2 - 160, canvas.height/2 + 40);
  }
}

// Collision helpers
function checkPumpkinCollision(player,p) {
  return rectsOverlap(player, p) && player.y + player.h > p.y + 20;
}

function rectsOverlap(a,b) {
  return a.x < b.x + b.w &&
         a.x + a.w > b.x &&
         a.y < b.y + b.h &&
         a.y + a.h > b.y;
}

function restartGame() {
  pumpkins = [];
  pumpkinTimer = 0;
  ghost.x = -200;
  ghost.speed = 0;
  ghost.startDelay = 120;
  ghost.chasing = false;
  score = 0;
  gameOver = false;
  loop();
}

loop();
</script>
</body>
</html>
