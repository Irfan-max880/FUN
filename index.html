<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Ghost Shooter</title>
<style>
body { margin:0; background:#000; overflow:hidden; }
canvas { display:block; margin:0 auto; background:#111; }
</style>
</head>
<body>
<canvas id="game" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Debug helper
function log(msg){ console.log("[GAME]", msg); }

// Background gradient fallback
const gradient = ctx.createLinearGradient(0,0,0,canvas.height);
gradient.addColorStop(0,"#05020a");
gradient.addColorStop(1,"#071226");

// Images
function loadImage(src){
    return new Promise((res,rej)=>{
        const img = new Image();
        img.onload=()=>{ log("Loaded image: "+src); res(img); };
        img.onerror=()=>{ log("Failed image: "+src); res(null); };
        img.crossOrigin="anonymous";
        img.src=src;
    });
}

let bgImg, ghostImg, fogImg;

// Audio
let bgMusic = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"); // free placeholder
bgMusic.loop = true;
bgMusic.volume = 0.3;
let musicStarted = false;

function tryPlayMusic(){
    if(!musicStarted){
        bgMusic.play().then(()=>{
            log("Music started");
            musicStarted = true;
        }).catch(err=>{
            log("Music blocked, will retry");
        });
    }
}

// Entities
let player = { x:100, y:300, w:40, h:40 };
let bullets = [];
let enemies = [];
let spawnTimer = 0;
let gameOver = false;

// Controls
window.addEventListener("keydown", e=>{
    if(e.code==="Space") player.y -= 60; // jump
    if(e.code==="KeyF") shoot();
    tryPlayMusic();
});
window.addEventListener("click", ()=>{
    shoot();
    tryPlayMusic();
});

function shoot(){
    bullets.push({ x:player.x+player.w, y:player.y+player.h/2-5, w:10, h:5, speed:6 });
}

// Game loop
function loop(){
    // Draw background
    if(bgImg) ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
    else {
        ctx.fillStyle = gradient;
        ctx.fillRect(0,0,canvas.width,canvas.height);
    }

    // Fog layer
    if(fogImg){
        ctx.globalAlpha=0.2;
        ctx.drawImage(fogImg, (Date.now()/50)%canvas.width - canvas.width,0,canvas.width,canvas.height);
        ctx.drawImage(fogImg, (Date.now()/50)%canvas.width,0,canvas.width,canvas.height);
        ctx.globalAlpha=1;
    }

    // Player
    ctx.fillStyle="lime";
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // Bullets
    bullets.forEach(b=>{
        b.x += b.speed;
        ctx.fillStyle="yellow";
        ctx.fillRect(b.x,b.y,b.w,b.h);
    });
    bullets = bullets.filter(b=>b.x<canvas.width);

    // Enemies
    spawnTimer--;
    if(spawnTimer<=0){
        enemies.push({ x:canvas.width, y:300, w:40, h:40, speed:1 });
        spawnTimer = 150; // spawn delay
    }
    enemies.forEach(en=>{
        en.x -= en.speed;
        if(ghostImg) ctx.drawImage(ghostImg,en.x,en.y,en.w,en.h);
        else {
            ctx.fillStyle="white";
            ctx.fillRect(en.x,en.y,en.w,en.h);
        }
    });

    // Bullet-enemy collision
    bullets.forEach(b=>{
        enemies.forEach((en,ei)=>{
            if(b.x < en.x+en.w && b.x+b.w > en.x &&
               b.y < en.y+en.h && b.y+b.h > en.y){
                enemies.splice(ei,1);
            }
        });
    });

    // Enemy-player collision
    enemies.forEach(en=>{
        if(en.x <= player.x+player.w){
            gameOver = true;
        }
    });

    // UI
    if(gameOver){
        ctx.fillStyle="red";
        ctx.font="40px Arial";
        ctx.fillText("GAME OVER", canvas.width/2-100, canvas.height/2);
    } else {
        requestAnimationFrame(loop);
    }
}

// Load assets, then start
(async function init(){
    bgImg = await loadImage("https://i.postimg.cc/L5tmbRTy/Screenshot-2025-0812-173844.png");
    ghostImg = await loadImage("https://i.postimg.cc/vDwc43PK/Screenshot-2025-0812-174643-removebg-preview.png");
    fogImg = await loadImage("https://i.ibb.co/ZYW3VTp/fog-seamless.png"); // large seamless fog
    log("Init complete");
    loop();
})();
</script>
</body>
</html>
